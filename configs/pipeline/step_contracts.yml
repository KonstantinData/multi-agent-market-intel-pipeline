steps:
  - step_id: "AG-00"
    agent_name: "ag00_intake_normalization"
    purpose: "Normalize raw intake into deterministic case_normalized payload"
    inputs:
      required_case_fields:
        - "company_name"
        - "web_domain"
    outputs:
      required_sections:
        - "step_meta"
        - "case_normalized"
        - "target_entity_stub"
        - "entities_delta"
        - "relations_delta"
        - "findings"
      case_normalized_required_fields:
        - "company_name_canonical"
        - "web_domain_normalized"
        - "entity_key"
      target_entity_stub_required_fields:
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "invalid_domain_format"
        - "invalid_entity_key"

  - step_id: "AG-01"
    agent_name: "ag01_source_registry"
    purpose: "Assemble the source registry and document source identification only"
    outputs:
      required_sections:
        - "step_meta"
        - "source_registry"
        - "findings"
        - "sources"
      source_registry_required_fields:
        - "primary_sources"
        - "secondary_sources"
        - "source_scope_notes"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_primary_sources"
        - "source_missing_required_fields"
        - "claims_without_sources"
      gatekeeper_rules:
        primary_sources_non_empty: true
        source_required_fields:
          - "publisher"
          - "url"
        findings_restrict_to_source_identification: true

  - step_id: "AG-10"
    agent_name: "ag10_identity_legal"
    purpose: "Extract verifiable legal identity signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      target_entity_required_fields:
        - "entity_id"
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
        - "legal_name"
        - "legal_form"
        - "founding_year"
        - "registration_signals"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_target_entity"
        - "invalid_entity_key"
        - "invalid_founding_year"
        - "invalid_registration_signals"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
