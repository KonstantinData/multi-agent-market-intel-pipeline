steps:
  - step_id: "AG-00"
    agent_name: "ag00_intake_normalization"
    purpose: "Normalize raw intake into deterministic case_normalized payload"
    inputs:
      required_case_fields:
        - "company_name"
        - "web_domain"
    outputs:
      required_sections:
        - "step_meta"
        - "case_normalized"
        - "target_entity_stub"
        - "entities_delta"
        - "relations_delta"
        - "findings"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      case_normalized_required_fields:
        - "company_name_canonical"
        - "web_domain_normalized"
        - "entity_key"
      target_entity_stub_required_fields:
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "invalid_domain_format"
        - "invalid_entity_key"

  - step_id: "AG-01"
    agent_name: "ag01_source_registry"
    purpose: "Assemble the source registry and document source identification only"
    outputs:
      required_sections:
        - "step_meta"
        - "source_registry"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      source_registry_required_fields:
        - "primary_sources"
        - "secondary_sources"
        - "source_scope_notes"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_primary_sources"
        - "source_missing_required_fields"
        - "claims_without_sources"
      gatekeeper_rules:
        primary_sources_non_empty: true
        source_required_fields:
          - "publisher"
          - "url"
          - "accessed_at_utc"
        findings_restrict_to_source_identification: true

  - step_id: "AG-10"
    agent_name: "ag10_identity_legal"
    purpose: "Extract verifiable legal identity signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
        - "field_sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      target_entity_required_fields:
        - "entity_id"
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
        - "legal_name"
        - "legal_form"
        - "founding_year"
        - "registration_signals"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_target_entity"
        - "invalid_entity_key"
        - "invalid_founding_year"
        - "invalid_registration_signals"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"

  - step_id: "AG-11"
    agent_name: "ag11_locations_sites"
    purpose: "Extract verified locations and operating sites for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
        - "search_attempts"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      site_entity_required_fields:
        - "entity_key"
        - "entity_type"
        - "entity_name"
        - "site_type"
        - "country_region"
        - "city"
      search_attempt_required_fields:
        - "url"
        - "accessed_at_utc"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
        - "missing_site_relation"
        - "invalid_site_entity"

  - step_id: "AG-20"
    agent_name: "ag20_company_size"
    purpose: "Extract verifiable company size signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      target_entity_required_fields:
        - "entity_id"
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
        - "employee_range"
        - "revenue_band"
        - "market_scope_signal"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_target_entity"
        - "missing_required_fields"
        - "invalid_entity_key"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"

  - step_id: "AG-21"
    agent_name: "ag21_financial_signals"
    purpose: "Extract verifiable financial development signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-30"
    agent_name: "ag30_portfolio"
    purpose: "Identify company portfolio offerings and solution lines"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-31"
    agent_name: "ag31_markets_focus"
    purpose: "Identify market focus and customer segments for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-40"
    agent_name: "ag40_target_customers"
    purpose: "Identify target customers for the company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      entity_required_fields:
        - "entity_key"
        - "entity_type"
        - "entity_name"
        - "domain"
      relation_required_fields:
        - "relation_type"
        - "source_id"
        - "target_id"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: true
        require_relations: true
        allowed_entity_types:
          - "customer"
        allowed_relation_types:
          - "supplies_to"
        entity_domain_allow_nv: true

  - step_id: "AG-41"
    agent_name: "ag41_peer_discovery"
    purpose: "Discover peer companies for competitive context"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      entity_required_fields:
        - "entity_key"
        - "entity_type"
        - "entity_name"
        - "domain"
      relation_required_fields:
        - "relation_type"
        - "source_id"
        - "target_id"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: true
        require_relations: true
        allowed_entity_types:
          - "manufacturer"
        allowed_relation_types:
          - "peer_of"
        required_entity_attributes:
          - "product_match_reason"
        entity_domain_allow_nv: true

  - step_id: "AG-42"
    agent_name: "ag42_customers_of_manufacturers"
    purpose: "Identify downstream customers or manufacturers served by the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      entity_required_fields:
        - "entity_key"
        - "entity_type"
        - "entity_name"
      relation_required_fields:
        - "relation_type"
        - "source_id"
        - "target_id"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: true
        allowed_entity_types:
          - "customer"
        allowed_relation_types:
          - "supplies_to"

  - step_id: "AG-50"
    agent_name: "ag50_projects_tenders"
    purpose: "Identify public projects, tenders, and investment signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-51"
    agent_name: "ag51_strategic_changes"
    purpose: "Identify strategic changes such as M&A, relocations, or partnerships"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-60"
    agent_name: "ag60_industry_cycles"
    purpose: "Identify industry production cycles and inventory cadence signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-61"
    agent_name: "ag61_surplus_stock"
    purpose: "Identify surplus indicators such as discounting, shutdowns, or layoffs"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-62"
    agent_name: "ag62_surplus_channels"
    purpose: "Identify surplus sales channels such as outlets or liquidation platforms"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-70"
    agent_name: "ag70_supply_chain_tech"
    purpose: "Identify supply chain technology signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-71"
    agent_name: "ag71_supply_chain_risks"
    purpose: "Identify supply chain risk signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-72"
    agent_name: "ag72_sustainability_circular"
    purpose: "Identify sustainability and circularity signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-80"
    agent_name: "ag80_market_position"
    purpose: "Identify market positioning signals relative to peers"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-81"
    agent_name: "ag81_industry_trends"
    purpose: "Identify industry trends relevant to the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-82"
    agent_name: "ag82_trade_fairs_events"
    purpose: "Identify trade fairs and events associated with the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-83"
    agent_name: "ag83_associations_memberships"
    purpose: "Identify industry associations and memberships"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false

  - step_id: "AG-90"
    agent_name: "ag90_sales_playbook"
    purpose: "Derive sales and negotiation playbook signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "prompt"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"
      gatekeeper_rules:
        findings_min_items: 1
        sources_min_items: 1
        allow_no_evidence: true
        require_sources_for_claims: true
        require_entities: false
        require_relations: false
