steps:
  - step_id: "AG-00"
    agent_name: "ag00_intake_normalization"
    purpose: "Normalize raw intake into deterministic case_normalized payload"
    inputs:
      required_case_fields:
        - "company_name"
        - "web_domain"
    outputs:
      required_sections:
        - "step_meta"
        - "case_normalized"
        - "target_entity_stub"
        - "entities_delta"
        - "relations_delta"
        - "findings"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      case_normalized_required_fields:
        - "company_name_canonical"
        - "web_domain_normalized"
        - "entity_key"
      target_entity_stub_required_fields:
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "invalid_domain_format"
        - "invalid_entity_key"

  - step_id: "AG-01"
    agent_name: "ag01_source_registry"
    purpose: "Assemble the source registry and document source identification only"
    outputs:
      required_sections:
        - "step_meta"
        - "source_registry"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      source_registry_required_fields:
        - "primary_sources"
        - "secondary_sources"
        - "source_scope_notes"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_primary_sources"
        - "source_missing_required_fields"
        - "claims_without_sources"
      gatekeeper_rules:
        primary_sources_non_empty: true
        source_required_fields:
          - "publisher"
          - "url"
          - "accessed_at_utc"
        findings_restrict_to_source_identification: true

  - step_id: "AG-10"
    agent_name: "ag10_identity_legal"
    purpose: "Extract verifiable legal identity signals for the target company"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
        - "field_sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      target_entity_required_fields:
        - "entity_id"
        - "entity_type"
        - "entity_name"
        - "domain"
        - "entity_key"
        - "legal_name"
        - "legal_form"
        - "founding_year"
        - "registration_signals"
        - "phone_number"
        - "email"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_target_entity"
        - "invalid_entity_key"
        - "invalid_founding_year"
        - "invalid_registration_signals"
        - "missing_sources_for_claims"
        - "source_missing_required_fields"

  - step_id: "AG-15"
    agent_name: "ag15_network_mapper"
    purpose: "Expand lead universe by identifying related companies and mapping business relationships"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      findings_required_fields:
        - "network_expansion_summary"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "entities_without_relations"
        - "claims_without_sources"
        - "invalid_industry_scope"
      gatekeeper_rules:
        core_industries_only: ["Medical Technology", "Mechanical Engineering", "Electrical Engineering"]
        relations_required_for_new_entities: true
        source_required_fields:
          - "publisher"
          - "url"
          - "accessed_at_utc"

  - step_id: "AG-20"
    agent_name: "ag20_size_evaluator"
    purpose: "Evaluate Liquisto lead fit based on company size profile signals"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
        - "company_size_profile.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
        - "evaluation"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "missing_company_size_profile"

  - step_id: "AG-21"
    agent_name: "ag21_financial_development"
    purpose: "Collect historical financial data to assess target companies for Liquisto"
    inputs:
      required_meta_artifacts:
        - "case_normalized.json"
        - "target_entity_stub.json"
    outputs:
      required_sections:
        - "step_meta"
        - "entities_delta"
        - "relations_delta"
        - "findings"
        - "sources"
      step_meta_required_fields:
        - "step_id"
        - "agent_name"
        - "run_id"
        - "started_at_utc"
        - "finished_at_utc"
        - "pipeline_version"
      findings_required_fields:
        - "currency"
        - "time_series"
        - "trend_summary"
    validation:
      hard_fail_if:
        - "missing_required_sections"
        - "missing_required_fields"
        - "claims_without_sources"
        - "source_missing_required_fields"
      gatekeeper_rules:
        source_required_fields:
          - "publisher"
          - "url"
          - "accessed_at_utc"
        financial_data_evidence_required: true
