{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/taxonomy.schema.json",
  "title": "Liquisto Classification Taxonomy",
  "type": "object",
  "required": ["version", "owner", "language", "levels", "classes"],
  "additionalProperties": false,
  "properties": {
    "version": { "type": "string", "minLength": 1 },
    "owner": { "type": "string", "minLength": 1 },
    "language": { "type": "string", "minLength": 2, "maxLength": 5 },
    "levels": { "type": "integer", "minimum": 1, "maximum": 5 },

    "classes": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/classNode" }
    },

    "tags": {
      "type": "array",
      "items": { "$ref": "#/$defs/tagNode" }
    }
  },

  "$defs": {
    "codeRef": {
      "type": "object",
      "required": ["system", "code", "label"],
      "additionalProperties": false,
      "properties": {
        "system": { "type": "string", "minLength": 1 },
        "code": { "type": "string", "minLength": 1 },
        "label": { "type": "string", "minLength": 1 }
      }
    },

    "classNode": {
      "type": "object",
      "required": ["id", "label", "level"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1,
          "pattern": "^[A-Z0-9_]+$"
        },
        "label": { "type": "string", "minLength": 1 },
        "level": { "type": "integer", "minimum": 1, "maximum": 5 },
        "parent_id": {
          "type": "string",
          "pattern": "^[A-Z0-9_]+$"
        },
        "codes": {
          "type": "array",
          "items": { "$ref": "#/$defs/codeRef" }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "level": { "const": 1 } },
            "required": ["level"]
          },
          "then": {
            "not": { "required": ["parent_id"] }
          },
          "else": {
            "required": ["parent_id"]
          }
        }
      ]
    },

    "tagNode": {
      "type": "object",
      "required": ["id", "label"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1,
          "pattern": "^[A-Z0-9_]+$"
        },
        "label": { "type": "string", "minLength": 1 },
        "codes": {
          "type": "array",
          "items": { "$ref": "#/$defs/codeRef" }
        }
      }
    }
  }
}
